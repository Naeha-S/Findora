<!DOCTYPE html>
<html>
<head>
    <title>Firestore Migration Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        button {
            background: #06b6d4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0891b2;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .log {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #06b6d4; }
    </style>
</head>
<body>
    <h1>üî• Firestore Migration Tool</h1>
    <p>This tool will migrate mock data from <code>data/mockData.ts</code> to Firestore.</p>
    
    <button id="migrateBtn" onclick="startMigration()">Start Migration</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div id="log" class="log"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, Timestamp, writeBatch } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Use your Firebase config from firebaseConfig.ts
        const firebaseConfig = {
            apiKey: "AIzaSyCOtxvCNCMUwGZp0TU6Kgdy4AfsZwlnhQ8",
            authDomain: "airadar-95005.firebaseapp.com",
            projectId: "airadar-95005",
            storageBucket: "airadar-95005.firebasestorage.app",
            messagingSenderId: "908342689643",
            appId: "1:908342689643:web:d654a26ba63464172e962e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Import mock data - you'll need to paste it here or load from a JSON file
        // For now, this is a placeholder that shows the structure
        window.startMigration = async function() {
            const logEl = document.getElementById('log');
            const btn = document.getElementById('migrateBtn');
            btn.disabled = true;

            function log(message, type = 'info') {
                const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
                logEl.innerHTML += `<span class="${className}">[${new Date().toLocaleTimeString()}] ${message}\n</span>`;
                logEl.scrollTop = logEl.scrollHeight;
            }

            log('üì¶ Starting migration...', 'info');

            try {
                // You need to import or paste your initialTools array here
                // For demonstration, we'll show the structure:
                log('‚ö†Ô∏è  Please copy your mockData.ts initialTools array and paste it in this script', 'info');
                log('‚ö†Ô∏è  Or create a JSON file and import it', 'info');
                
                // Example structure:
                const exampleTools = []; // Replace with actual initialTools

                if (exampleTools.length === 0) {
                    log('‚ùå No tools to migrate. Please add your tools array.', 'error');
                    btn.disabled = false;
                    return;
                }

                log(`üì¶ Migrating ${exampleTools.length} tools...`, 'info');

                const batch = writeBatch(db);
                let count = 0;

                for (const tool of exampleTools) {
                    // Convert ISO strings to Timestamps
                    const toolRef = doc(db, 'tools', tool.id);
                    const toolData = {
                        name: tool.name,
                        description: tool.description,
                        category: tool.category,
                        officialUrl: tool.officialUrl,
                        firstSeenAt: Timestamp.fromDate(new Date(tool.firstSeenAt)),
                        lastVerifiedAt: Timestamp.fromDate(new Date(tool.lastVerifiedAt)),
                        mentionCount: tool.mentionCount,
                        trendScore: tool.trendScore,
                        status: 'active',
                    };

                    batch.set(toolRef, toolData);

                    // Create pricing document
                    const pricingRef = doc(db, 'pricing', tool.id);
                    const pricingData = {
                        toolId: tool.id,
                        pricingModel: tool.pricing.model,
                        freeTier: {
                            exists: tool.pricing.freeTier.exists,
                            limit: tool.pricing.freeTier.limit,
                            watermark: tool.pricing.freeTier.watermark,
                            requiresSignup: tool.pricing.freeTier.requiresSignup,
                            requiresCard: tool.pricing.freeTier.requiresCard,
                            commercialUse: tool.pricing.freeTier.commercialUse,
                            attribution: tool.pricing.freeTier.attribution,
                        },
                        paidTier: {
                            startPrice: tool.pricing.paidTier.startPrice,
                            billingOptions: tool.pricing.paidTier.billingOptions,
                        },
                        confidence: tool.pricing.confidence,
                        sourceUrl: tool.pricing.sourceUrl,
                        lastCheckedAt: Timestamp.fromDate(new Date(tool.pricing.lastCheckedAt)),
                    };

                    batch.set(pricingRef, pricingData);

                    count++;
                    if (count % 50 === 0) {
                        await batch.commit();
                        log(`‚úÖ Migrated ${count} tools...`, 'success');
                    }
                }

                await batch.commit();
                log(`‚úÖ Successfully migrated ${exampleTools.length} tools to Firestore!`, 'success');
                log('üéâ Migration complete!', 'success');
            } catch (error) {
                log(`‚ùå Migration failed: ${error.message}`, 'error');
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        };

        window.clearLog = function() {
            document.getElementById('log').innerHTML = '';
        };
    </script>
</body>
</html>
